

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.42.1 with theme Tranquilpeak 0.4.3-BETA">
    <title>Sentiment Analysis of Mahabharata using F#</title>
    <meta name="author" content="Kunjan Dalal">
    <meta name="keywords" content="">

    <link rel="icon" href="http://kunjan.in/favicon.png">
    

    
    <meta name="description" content="This article is part of FSAdvent 2016 calendar.
This my second post of 2016. Sadly not much of writing this year. So, I need to cover up by this little longish post. So, grab your favorite coffee / tea before getting started.
There is one wonderful coincidence here that both post of 2016 is based on Epic Mahabharata. If anyone interested in poem like things do check out my another post.">
    <meta property="og:description" content="This article is part of FSAdvent 2016 calendar.
This my second post of 2016. Sadly not much of writing this year. So, I need to cover up by this little longish post. So, grab your favorite coffee / tea before getting started.
There is one wonderful coincidence here that both post of 2016 is based on Epic Mahabharata. If anyone interested in poem like things do check out my another post.">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Sentiment Analysis of Mahabharata using F#">
    <meta property="og:url" content="/2016/12/epic-adventure-using-fsharp/">
    <meta property="og:site_name" content="Kunjan&#39;s Web Space">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Kunjan&#39;s Web Space">
    <meta name="twitter:description" content="This article is part of FSAdvent 2016 calendar.
This my second post of 2016. Sadly not much of writing this year. So, I need to cover up by this little longish post. So, grab your favorite coffee / tea before getting started.
There is one wonderful coincidence here that both post of 2016 is based on Epic Mahabharata. If anyone interested in poem like things do check out my another post.">
    
      <meta name="twitter:creator" content="@kunjee">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/3d7c012bb27ad7b2f40976c5edc58968?s=640">
    

    
    
    

    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="http://kunjan.in/css/style-jsjn0006wyhpyzivf6yceb31gvpjatbcs3qzjvlumobfnugccvobqwxnnaj8.min.css" />
    
    

    
      
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-37975068-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="http://kunjan.in/">Kunjan&#39;s Web Space</a>
  </div>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="http://kunjan.in/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/3d7c012bb27ad7b2f40976c5edc58968?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Kunjan Dalal</h4>
        
          <h5 class="sidebar-profile-bio"><em>All idea, opinion are my own and don&rsquo;t reflect opinion of my current or any former employer.</em></h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://kunjan.in/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://kunjan.in/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://kunjan.in/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://kunjan.in/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://kunjan.in/about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://kunjan.in/resume">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">Resume</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/kunjee17" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="http://kunjan.in/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Sentiment Analysis of Mahabharata using F#
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2016-12-17T00:00:00Z">
        
  December 17, 2016

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="http://kunjan.in/categories/technical">Technical</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              

<p>This article is part of <a href="https://sergeytihon.wordpress.com/2016/10/23/f-advent-calendar-in-english-2016/">FSAdvent 2016 calendar</a>.</p>

<p>This my second post of 2016. Sadly not much of writing this year. So, I need to cover up by this little longish post. So, grab your favorite coffee / tea before getting started.</p>

<p>There is one wonderful coincidence here that both post of 2016 is based on Epic Mahabharata. If anyone interested in poem like things do check out my <a href="http://kunjan.in/2016/04/my-identity/">another post</a>.</p>

<h2 id="epic-mahabharata">Epic Mahabharata</h2>

<p>Many people heard of it but few lucky get chance to read it. Or even fewer know thing in detail about it. As per global source of truth <a href="https://en.wikipedia.org/wiki/Mahabharata">Wikipedia</a> It is &ldquo;longest <em>poem</em> ever written&rdquo; in human history. It has around 1.8 million words in total. It is roughly 10 times the length of Iliad and Odyseey combined.</p>

<p>So, what is there in it? We can say everything. Love stories to stories about war to stories about revenge. Philosophy to military tactics. Policies on tax, rules of espionage, watch over enemies and how to find the most able people and make them ministers. Theory karma which is part of Gita,  which is part of Mahabharata. Yog (not to confuse with physical Yoga people do) explained in Mahabharata and so do life, death and life after death. A tale where God not solve problems for you but guide you to solution, enable you face the problems. A story where God is not forefather but a friend who is always there for you.</p>

<p>A story where even God accept curse with due respect given by a mother. A story where story teller him self not only narrate the story but also integral part of it. A tale stays same but meaning of it keep changing to every reader. A story which has spiral of different small stories consisting further different stories. A infinite source of knowledge, wisdom and fun.</p>

<p>I can go on and on; but let&rsquo;s come back to F#.</p>

<h2 id="natural-language-processing">Natural Language Processing</h2>

<p>Understanding the human language, words and sentiments always is exciting. Specially using your favourite programming language. Processing old epic books is always fun, as it not only tells about history / mythology but take back to your heritage and culture. So, This part is from my Mentorship program (more details at the end). An article born from <em>home work</em> I got recently.</p>

<p>I don&rsquo;t know the complexity level of it. It totally depends on reader. But results are indeed too good.</p>

<h2 id="let-the-fun-begin">Let the fun Begin</h2>

<p>First thing is to find out source in English (As it is easy to compare with data sets.). <a href="https://www.gutenberg.org">Project Gutenberg</a> is good place to find some license free text. If you like to do code with this article then get your favourite book from site or you can always download if <a href="https://github.com/kunjee17/mahabharata/tree/master/txt_data">from my project</a>.</p>

<p>That is whole Mahabharata in four text files. So, I did some manual labour to separate the books from it. You can find them <a href="https://github.com/kunjee17/mahabharata/tree/master/books">here</a>. There are total 18 books (sub books are not separated).</p>

<p>Let&rsquo;s start with simple File IO.</p>

<pre><code class="language-fsharp">    let booknos = [|
                &quot;01&quot;;
                &quot;02&quot;;
                &quot;03&quot;;
                &quot;04&quot;;
                &quot;05&quot;;
                &quot;06&quot;;
                &quot;07&quot;;
                &quot;08&quot;;
                &quot;09&quot;;
                &quot;10&quot;;
                &quot;11&quot;;
                &quot;12&quot;;
                &quot;13&quot;;
                &quot;14&quot;;
                &quot;15&quot;;
                &quot;16&quot;;
                &quot;17&quot;;
                &quot;18&quot;
                |]

    let trms = booknos.[0] |&gt;  (fun x -&gt;
            Path.Combine(__SOURCE_DIRECTORY__, &quot;..&quot;, &quot;books/&quot;+ x + &quot;.txt&quot;) |&gt; File.ReadAllLines |&gt; String.concat &quot; &quot;
                    ) |&gt; (fun y -&gt; y.Split ' ')


</code></pre>

<p>That&rsquo;s quite a lot terms for small piece of code. Now, we are one step behind to become data scientist.</p>

<p>Let&rsquo;s find the unique terms and frequency of them.</p>

<pre><code class="language-fsharp">    let uniqtrms = trms |&gt; Array.countBy id
</code></pre>

<p>see another line and we are done. We are now official data scientists.</p>

<p>Go ahead and try for other books also. If you are feeling lazy you can check out <a href="http://kunjan.in/mahabharata/book-details">results here</a> or see below.</p>

<p>For Terms:</p>

<p><img src="http://kunjan.in/images/mahabharata/terms.png" alt="" /></p>

<p>For Unique Terms:
<img src="http://kunjan.in/images/mahabharata/uniqueterms.png" alt="" /></p>

<p>For Unique Terms per Terms
<img src="http://kunjan.in/images/mahabharata/utbyterms.png" alt="" /></p>

<p>What next? Let&rsquo;s do the sentiment analysis of all this books and compare them with each others.</p>

<h2 id="sentiment-analysis">Sentiment Analysis</h2>

<h3 id="whaaat">Whaaat?</h3>

<p>Analysis done to find out the tone of given text. Here we are having books. Basically using this we can find out that books is more joyful to read or tilted towards sadness. How many surprise elements book do have. It is useful to understand conversation, if it is more towards positive end or negative end.</p>

<h3 id="coding-bits">Coding bits</h3>

<p>It will make more sense while comparing.</p>

<p>As everything else in F# here we also start with type and start putting things in it. Let&rsquo;s call it Book type. Because why not.</p>

<pre><code class="language-fsharp">    type SentimentInNumber = {
        Anger:float
        Anticipation:float
        Disgust:float
        Fear:float
        Joy:float
        Negative:float
        Positive:float
        Sadness:float
        Surprise:float
        Trust:float
        Word: string
    }

    type Word = {
        Term :string
        Rating : int
    }


    type Book = {
        Name : string
        Text : string
        UniqueTerms : Set&lt;string&gt;
        Terms : string []
        UniqueTermsWithFrequency : (string * int) []
        SentimentIndex : SentimentInNumber
        WordsRating : Word []
    }
</code></pre>

<p>Now, for a second keep this aside. We need more details or here data to find out sentiments. Data with which we can compare our book terms. So, we will be using two
data sets. For emotions we will be  using <a href="http://saifmohammad.com/WebPages/NRC-Emotion-Lexicon.htm">this</a> and for positive / negative ratings we will be using <a href="http://www2.imm.dtu.dk/pubdb/views/publication_details.php?id=6010">this</a>.</p>

<p>Here are what they look like.</p>

<p>Emotion Lexicon:
<img src="http://kunjan.in/images/mahabharata/sentiment.png" alt="" /></p>

<p>And Word with Ratings:
<img src="http://kunjan.in/images/mahabharata/posneg.png" alt="" /></p>

<p>Traditional way to pull data out of CSV file is <code>for -&gt; for -&gt; for</code> loops. But we are in F# land, we will be using csv Type Provider. Let&rsquo;s pull data out of CSV and shape it in types.</p>

<pre><code class="language-fsharp">
    let sentimentCSVPath = Path.Combine(__SOURCE_DIRECTORY__, &quot;..&quot;,&quot;data/Basic_Emotions_(size_is_proportional_to_number_of__data.csv&quot;)
    type SentimentCsv = CsvProvider&lt; &quot;../data/Basic_Emotions_(size_is_proportional_to_number_of__data.csv&quot;&gt;

    let SentimentData = SentimentCsv.Load(&quot;../data/Basic_Emotions_(size_is_proportional_to_number_of__data.csv&quot;)

    type SentimentInNumber = {
        Anger:float
        Anticipation:float
        Disgust:float
        Fear:float
        Joy:float
        Negative:float
        Positive:float
        Sadness:float
        Surprise:float
        Trust:float
        Word: string
    }

    let sentimentCalculate (anger,anticipation, disgust,emotion,fear, joy, negative, positive, sadness, surprise, trust, word) =
        let a = {
            Anger = stringToNum anger
            Anticipation = stringToNum anticipation
            Disgust = stringToNum disgust
            Fear = stringToNum fear
            Joy = stringToNum joy
            Negative = stringToNum negative
            Positive = stringToNum positive
            Sadness = stringToNum sadness
            Surprise = stringToNum surprise
            Trust = stringToNum trust
            Word = word
        }

        match emotion with
        | Anger -&gt; if a.Anger = 0. then {a with Anger = 1.} else a
        | Anticipation -&gt; if a.Anticipation = 0. then {a with Anticipation = 1.} else a
        | Disgust -&gt; if a.Disgust = 0. then {a with Disgust = 1. } else a
        | Fear -&gt; if a.Fear = 0. then {a with Fear = 1.} else a
        | Joy -&gt; if a.Joy = 0. then {a with Joy = 1.} else a
        | Negative -&gt; if a.Negative = 0. then {a with Negative = 1.} else a
        | Positive -&gt; if a.Positive = 0. then {a with Positive = 1.} else a
        | Sadness -&gt; if a.Sadness = 0. then {a with Sadness = 1.} else a
        | Surprise -&gt; if a.Surprise = 0. then {a with Surprise = 1.} else a
        | Trust -&gt; if a.Trust = 0. then {a with Trust = 1.} else a
        | _ -&gt; a

    let allSentimentsInNumber =
        SentimentData.Rows
        |&gt; Seq.map (fun row -&gt;
            sentimentCalculate (
                    row.Anger,
                    row.Anticipation,
                    row.Disgust,
                    row.Emotion,
                    row.Fear,
                    row.Joy,
                    row.Negative,
                    row.Positive,
                    row.Sadness,
                    row.Surprise,
                    row.Trust,
                    row.Word
                    ))
    let SentimentWordsSet = allSentimentsInNumber |&gt; Seq.map (fun row -&gt; row.Word) |&gt; set

</code></pre>

<p>Here is the thing about this data. Emotion column is also specifying the emotion, not always but they are there. So, we need them too. That is reason for that extra calcution we are doing. Here for every emotion found we are adding 1 else it is 0.</p>

<p>If you can see I am not comparing with string but with concrete F# term. It is because in data we are having &ldquo;anticip&rdquo; for &ldquo;anticipation&rdquo;. Now, in future if we add another data to this collection and they have &ldquo;anticipation&rdquo; then it will add extra case for same result. So, it would be better to encapsulate them away. And clean way to do that using Active patterns.</p>

<p>Here is missing piece of code.</p>

<pre><code class="language-fsharp">    //Active Pattern for Sentiments
    let (|Anger|_|) input =
        if input = &quot;anger&quot; then Some Anger else None
    let (|Anticipation|_|) input =
        if input = &quot;anticip&quot; then Some Anticipation else None
    let (|Disgust|_|) input =
        if input = &quot;disgust&quot; then Some Disgust else None
    let (|Fear|_|) input =
        if input = &quot;fear&quot; then Some Fear else None
    let (|Joy|_|) input =
        if input = &quot;joy&quot; then Some Joy else None
    let (|Negative|_|) input =
        if input = &quot;negative&quot; then Some Negative else None
    let (|Positive|_|) input =
        if input = &quot;positive&quot; then Some Positive else None
    let (|Sadness|_|) input =
        if input = &quot;sadness&quot; then Some Sadness else None
    let (|Surprise|_|) input =
        if input = &quot;surprise&quot; then Some Surprise else None
    let (|Trust|_|) input =
        if input = &quot;trust&quot; then Some Trust else None

</code></pre>

<p>As we are having more than 7 cases, we will be using partial Active Patterns and join them in match statement.</p>

<p>Same can be done for word with Positive and Negative ratings.</p>

<p>Here is code for same.</p>

<pre><code class="language-fsharp">    type Word = {
        Term :string
        Rating : int
    }

    let WordList =
        Path.Combine(__SOURCE_DIRECTORY__, &quot;..&quot;, &quot;data/AFINN/&quot;+ &quot;AFINN-111&quot; + &quot;.txt&quot;)
        |&gt; File.ReadAllLines
        |&gt; Array.map (fun x -&gt;
                        x.Split '\t' |&gt; (fun b -&gt; {Term = b.[0]; Rating = System.Int32.Parse b.[1]})
                        )
</code></pre>

<p>Great. Now stage is set to convert books made of terms to books made of numbers. Let&rsquo;s create for one book and then we will loop it for our array.</p>

<pre><code class="language-fsharp">    let create (bookname:string) (booktext :string) =
        let terms = Terms booktext
        let termsCount = terms.Length |&gt; float
        let termsWithFrequency = UniqueTermsWithFrequency terms
        let uniqueTerms = termsWithFrequency |&gt; Array.map (fun (x,_) -&gt; x)

        {
            Name = bookname
            Text = booktext
            UniqueTerms = uniqueTerms |&gt; set
            Terms = terms
            UniqueTermsWithFrequency = termsWithFrequency
            SentimentIndex =
                let commonEmotions = uniqueTerms |&gt; set |&gt; Set.intersect SentimentWordsSet
                let commonEmotionsCount = termsWithFrequency
                                            |&gt; Array.filter(fun (x,_) -&gt; commonEmotions.Contains x)
                                            |&gt; Array.map (fun (_,y) -&gt; y) |&gt; Array.sum |&gt; float
                let commonEmotionsInNumber = allSentimentsInNumber |&gt; Seq.filter (fun x -&gt; commonEmotions.Contains x.Word) |&gt; Seq.toArray
                let r = commonEmotionsInNumber |&gt; Array.fold (SentimentSum bookname) ZeroSentiment

                { r with
                    Anger = (r.Anger/commonEmotionsCount) * 100.
                    Anticipation = (r.Anticipation/commonEmotionsCount) * 100.
                    Disgust =(r.Disgust/commonEmotionsCount) * 100.
                    // Emotion = (r.Emotion)
                    Fear = (r.Fear/commonEmotionsCount) * 100.
                    Joy = (r.Joy/commonEmotionsCount) * 100.
                    Negative = (r.Negative/commonEmotionsCount) * 100.
                    Positive = (r.Positive/commonEmotionsCount) * 100.
                    Sadness = (r.Sadness/commonEmotionsCount) * 100.
                    Surprise = (r.Surprise/commonEmotionsCount) * 100.
                    Trust = (r.Trust/commonEmotionsCount) * 100.
                }
            WordsRating =
                let commonWords =
                    WordList
                    |&gt; Array.map (fun x -&gt; x.Term)
                    |&gt; set
                    |&gt; Set.intersect (uniqueTerms |&gt; set)
                WordList
                |&gt; Array.filter (fun a -&gt; commonWords.Contains a.Term)
        }

</code></pre>

<p>Single function and it&rsquo;s done. That&rsquo;s it. What we are doing in that? Creating our Book type.</p>

<p>Terms and Unique Terms were extracted away.</p>

<pre><code class="language-fsharp">    let Terms (input:string)=
            input
            |&gt; (fun x -&gt; x.Split ' ')
            |&gt; Array.map (removeSpecialChars &gt;&gt; (fun x -&gt; x.Trim()))
            |&gt; Array.filter (fun x -&gt; x &lt;&gt; &quot;&quot;)

    let UniqueTermsWithFrequency (input:string[])=
            input
            |&gt; Array.countBy id
</code></pre>

<p>Little bit complicated looking part is where we are trying to find <code>Sentiment Index</code> for book. So, first step is clean up the word set. That is the reason we are using unique terms. All terms are not present in data set we are having. So, there is need to take common terms. Again no more loops and conditions. They are two sets we need common terms so just intersect it. One line without performance over head. Now find out Sentiment details for that word and to get for book just fold it and do the sum of it. Done.</p>

<pre><code class="language-fsharp">    let ZeroSentiment = {
        Anger = 0.
        Anticipation = 0.
        Disgust =0.
        Fear = 0.
        Joy = 0.
        Negative = 0.
        Positive = 0.
        Sadness = 0.
        Surprise = 0.
        Trust = 0.
        Word = String.Empty
    }

    let SentimentSum word a b =
        {
            Anger = a.Anger + b.Anger
            Anticipation = a.Anticipation + b.Anticipation
            Disgust = a.Disgust + b.Disgust
            // Emotion = a.Emotion + b.Emotion
            Fear = a.Fear + b.Fear
            Joy = a.Joy + b.Joy
            Negative = a.Negative + b.Negative
            Positive = a.Positive + b.Positive
            Sadness = a.Sadness + b.Sadness
            Surprise = a.Surprise + b.Surprise
            Trust = a.Trust + b.Trust
            Word = word
        }
</code></pre>

<p>So, we are having all the data in memory. In our case in FSI / REPL.</p>

<p>As we are official data scientist we required that we see things in Graph format. So, first let&rsquo;s conver things to JSON and write to disk so we can use it.</p>

<pre><code class="language-fsharp">    module Utility =
        let JsonDropPath name =
            Path.Combine (__SOURCE_DIRECTORY__, &quot;..&quot;, &quot;docs/js/&quot; + name + &quot;.json&quot;)
        let dataToJSONFile (fileName : string)(data :'a) =
            let path = JsonDropPath fileName
            use writer = new StreamWriter(path)
            let txt = data |&gt; Compact.serialize
            writer.WriteLine (txt)
</code></pre>

<p>Here I am using <a href="https://github.com/Microsoft/fsharplu/wiki/fsharplu.json">Fsharplu.Json</a>, do check their <a href="https://blogs.msdn.microsoft.com/dotnet/2016/12/13/project-springfield-a-cloud-service-built-entirely-in-f/">project story</a>.</p>

<p>Now, once JSON is ready we can easily use to show in graph using any graph library.</p>

<blockquote>
<p>Here I did little cheating and wrote some dirty JavaScript. A good practise would be to write code in <a href="http://fable.io/">Fable</a>. So, I will not show code of JavaScript part.</p>
</blockquote>

<p>You can find book wise graphs <a href="http://kunjan.in/mahabharata/bookwise-sentiment">here</a> and transformed analysis <a href="http://kunjan.in/mahabharata/sentiment-wise">here</a> which is sentiment wise. Or Check out few of them below.</p>

<p>Book Wise:</p>

<p><img src="http://kunjan.in/images/mahabharata/karnaparv.png" alt="" /></p>

<p><img src="http://kunjan.in/images/mahabharata/mahaprasthanikaparv.png" alt="" /></p>

<p><img src="http://kunjan.in/images/mahabharata/shalyaparv.png" alt="" /></p>

<p>Sentiment Wise:</p>

<p><img src="http://kunjan.in/images/mahabharata/anger.png" alt="" /></p>

<p><img src="http://kunjan.in/images/mahabharata/joy.png" alt="" /></p>

<p><img src="http://kunjan.in/images/mahabharata/trust.png" alt="" /></p>

<p>Same can be done for positive and negative word set. (DYI for you.)</p>

<h2 id="reading-the-graphs-experience">Reading the Graphs &amp; Experience</h2>

<p>One thing needed to be understand here. Data set are created by human, code is written by human and code is executed by dumb computer. So, there is and always will be little bit manual tweaking. As language is topic with perception. One need to understand culture / history of those words from where they are coming. Graphs should be read in that context only. Let me put an example here.</p>

<p>Check out word frequency graph <a href="http://kunjan.in/mahabharata/word-frequency">here</a>. Pick any graph. Here I am taking three graphs to compare.</p>

<p><img src="http://kunjan.in/images/mahabharata/w1.png" alt="" /></p>

<p><img src="http://kunjan.in/images/mahabharata/w2.png" alt="" /></p>

<p><img src="http://kunjan.in/images/mahabharata/w3.png" alt="" /></p>

<p>&ldquo;Great&rdquo; would be always first. And &ldquo;Fire&rdquo; will come in last five always. In normal western literature &ldquo;Great&rdquo; word used as adverb for person or thing. But in Indian or Mahabharata context they use it to address someone. Like
<code>Hey, Great worrier Arjuna</code>. A poetic way of saying things. Looks good but also make word totally useless in context of understanding phrase. This issue can be solved with Inverse Document Frequency but again it is an extra effort. Same goes for word &ldquo;Fire&rdquo;. It is having negative value in normal context but in this specific context it is not that negative. Fire God and Fire it self (yagna) are positive. It is very much contextual.</p>

<p>But again generating graph is much more <em>data sciencey</em> to explain.</p>

<h2 id="what-s-next">What&rsquo;s Next</h2>

<p>Next step would be doing more detailed analysis of this Epic. Compare number / analysis with original context of books. Try to push number as near as possible to words. And probably extract some good NLP library from it.</p>

<p>All books are divided in sub-books <a href="http://kunjan.in/mahabharata/index">telling different stories</a>. Wiki links are added in Table list. If you are interested then check them out.</p>

<p><a href="https://github.com/kunjee17/mahabharata/blob/master/Mahabharata/Lesson1.fsx">Complete script file for this article is available over github</a>.</p>

<p>Download your favourite books and have fun with graphs.</p>

<h2 id="thanks-note">Thanks Note</h2>

<p>Special Thanks to people without whom this project may not exist.</p>

<p><a href="http://rachelree.se/">Rachel Reese</a> - For arranging this season of <a href="http://fsharp.org/mentorship/">Mentorship program</a>.</p>

<blockquote>
<p>Mentorship program : In simple words. It is a program where Mentor and Mentee are tagged with each other. And they have hour / week to teach / learn some topic specific to F#. As highly technical people things looks little old school but the effect that flesh and blood can create nothing else can. No books or no recorded videos. 45 - 60 minutes can cover more than one can cover in month or two using deal material. It is always good to have someone there alive in front of you whom you can ask questions. Again that is all my preference and what I like about this program.</p>
</blockquote>

<p><a href="http://www.roundcrisis.com/">Andrea</a> - For last season of Mentorship program.</p>

<p><strong><em>My lovely fiancée for not only allowing me but also encouraging me to give extra time to this.</em></strong></p>

<p><a href="https://twitter.com/tirthpandya">Saheb</a> to be my phone a friend for any kind of machine learning and data science queries.</p>

<p><a href="http://devdutt.com/">Devdutt</a>, my current favourite mythologist. Author of two of my favourite books <a href="http://devdutt.com/books/jaya-3.html">Jaya</a> and <a href="http://devdutt.com/books/my-gita.html">My Gita</a> in this genre</p>

<h2 id="note-to-my-mentor">Note to my Mentor</h2>

<p>Words can&rsquo;t explain how much grateful I am to have <a href="http://evelinag.com/">Evelina Gabasova</a> as my mentor or may be guru would make much more sense in current context. After a long time I can have kid&rsquo;s curiosity and innocence to ask anything and everything to her. And she is always there with answer and ever smiling face. Always pushing extra mile to beat the time zone differences.</p>

<p>In Mahabharata, Krishna narrate Gita to Arjuna in middle of war field; empowering him with eternal knowledge. Just like that,</p>

<blockquote>
<p>Hey, <strong>Great Evelina</strong>, I am no Arjuna but you are always been my Krishne. Guiding my way in the flood of data. It is always good to have you around. Be as mentor and as friend. Please be there always.</p>
</blockquote>

<h2 id="closing">Closing</h2>

<p>I like to close with few of my favourite picture describing war moments of Mahabharata</p>

<p><strong>Krishna narrating Gita to Arjuna</strong>
<img src="http://kunjan.in/images/mahabharata/m1.jpg" alt="" /></p>

<p><strong>Krishna driving Arjuna in war field</strong>
<img src="http://kunjan.in/images/mahabharata/m3.jpg" alt="" /></p>

<p><strong>Krishna, Arjuna and Bhisma three great warriors but helpless in front of time (situation)</strong>
<img src="http://kunjan.in/images/mahabharata/m2.jpg" alt="" /></p>

              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="http://kunjan.in/tags/functional-programming/">Functional Programming</a>

  <a class="tag tag--primary tag--small" href="http://kunjan.in/tags/natural-language-processing/">Natural Language Processing</a>

  <a class="tag tag--primary tag--small" href="http://kunjan.in/tags/data-science/">Data Science</a>

                  </div>
                
              
            
            
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://kunjan.in/2017/12/indian-chaat-with-fsharp/" data-tooltip="Reactive Chat application using ServiceStack and Fable in F#">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://kunjan.in/2016/04/my-identity/" data-tooltip="My Identity">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Kunjan Dalal. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        
  <div class="post-actions-wrap">
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://kunjan.in/2017/12/indian-chaat-with-fsharp/" data-tooltip="Reactive Chat application using ServiceStack and Fable in F#">
              
                  <i class="fa fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="http://kunjan.in/2016/04/my-identity/" data-tooltip="My Identity">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fa fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fa fa-share-alt"></i>
          </a>
        </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#disqus_thread">
            <i class="fa fa-comment-o"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#">
        
          <i class="fa fa-list"></i>
        </a>
      </li>
    </ul>
  </div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fa fa-close"></i>
  <ul class="share-options">
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/3d7c012bb27ad7b2f40976c5edc58968?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Kunjan Dalal</h4>
    
      <div id="about-card-bio"><em>All idea, opinion are my own and don&rsquo;t reflect opinion of my current or any former employer.</em></div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Functional Developer&hellip; Literally!
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        India
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" rel="noopener" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://kunjan.in/2018/03/opinionated-fable-architecture-and-performance/">
                <h3 class="media-heading">Opinionated Fable - Architecture &amp; Performance</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Mar 3, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">There can&rsquo;t be better time for writing this blog. As Fable 2.0 is on the horizon it would be good to see what 1.0 already can do. And I can also wish few things to be added to 2.0.
I have chosen Fable after evaluating couple of options like TypeScript-React-Redux, Elm, Aurelia, Angular. One thing I was pretty much sure that I wanted static typing in my project. Because I did have first hand experience with big fat Angular application built using JavaScript.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://kunjan.in/2017/12/indian-chaat-with-fsharp/">
                <h3 class="media-heading">Reactive Chat application using ServiceStack and Fable in F#</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2017
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Here is my Birthday blog post, as a part of FSAdvent - 2017. Just like previous two years, I hope you will enjoy this one too. Comments and corrections are very much welcomed.
 Why Chaat? and What is Chaat? If anyone wanted to show real time application, then Chat is kind of to-do list of that type of applications. Now Functional Chat is a very limited title and can&rsquo;t show all the things I wanted to show.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://kunjan.in/2016/12/epic-adventure-using-fsharp/">
                <h3 class="media-heading">Sentiment Analysis of Mahabharata using F#</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">This article is part of FSAdvent 2016 calendar.
This my second post of 2016. Sadly not much of writing this year. So, I need to cover up by this little longish post. So, grab your favorite coffee / tea before getting started.
There is one wonderful coincidence here that both post of 2016 is based on Epic Mahabharata. If anyone interested in poem like things do check out my another post.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://kunjan.in/2016/04/my-identity/">
                <h3 class="media-heading">My Identity</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2016
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Few words dedicated to people who made me who I am right now, my teachers. I know few of them personally and few others I am yet to meet in person. But they are still there always for me. Guiding me and helping me whenever and wherever I need. Words are not enough to say Thanks but still here with my small try
Here is original Gujarati Version
જેને કોઈ ઓળખની જરૂર નથી</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://kunjan.in/2015/12/1729/">
                <h3 class="media-heading">1729</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Dec 12, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">This post is part of F# Advent calender. Thanks Sergey Tihon for arranging this and giving me chance.
 First I like to clarify that this was not my original choice for FSAdvent calender. I was going to write long post about web, AKKA, api and real time system. My current working area. But this time&rsquo;s calender entries are reaching new level and dimension. And recent post from Evelina Gabasova is kind of reason behind change.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://kunjan.in/2015/11/reactive-services-with-servicestack-and-fsharp/">
                <h3 class="media-heading">Reactive Services with Servicestack and F#</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Nov 11, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Reactive word is not new nowadays. If you want your library to get limelight, use reactive word in the name any way possible and it will definitely get initial attention. Reactive word is appropriate for things that follows reactive manifesto. That is true for now. And there are many variant of libraries on server and client to fulfil this.
Let&rsquo;s start from the start of web.
We were having old web were we used to do post event of page.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://kunjan.in/2015/11/azure-web-sites-with-paket/">
                <h3 class="media-heading">Azure web sites with Paket</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Nov 11, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Whoever worked with Microsoft Shop knows about nuget. It is package manager for anything and everything related to .Net. And it is getting better and better with versions coming in. But again it is nowhere near maturity needed to work with projects having many small projects. Things get cranky soon.
Now, there is better option as per my opinion called Paket. Very easy to get started. And so damn reliable. Couple of more command to learn but I guess it is ok.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://kunjan.in/2015/11/angularjs-and-the-mess-we-are-in/">
                <h3 class="media-heading">Angularjs and the Mess we are in</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Nov 11, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Who doesn&rsquo;t know Angularjs?!? Everyone worked is web, mobile, server, windows, mac, Linux, Google, Microsoft or anyway related to this knows about it. And its fun when people tell me
 You know about angularjs. Its pretty hot now a days. I&rsquo;m planning to learn it.
 Oh man&hellip;
Ok I am no expert here in Angularjs. And I prefer not to be expert with any framework. Be it anything.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://kunjan.in/2015/04/functional-command-pattern/">
                <h3 class="media-heading">Functional Command Pattern</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Command pattern is a pattern which allows executor of the pattern to execute or playback the commands. In most of the application wherever Undo/Redo is implemented this pattern is used.
Here is C# code.
 Now, in this code Command Pattern is not in its purest form. As, normally in command pattern we are saving state of outside object. Instead I just returned the result to mock out side object.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="http://kunjan.in/2015/04/functional-strategy-pattern/">
                <h3 class="media-heading">Functional Strategy Pattern</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Apr 4, 2015
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather">Another pattern that is widely used in Object Oriented world. And as far as .Net world is concern it is may be most used pattern in wide range of .Net API. And it heavily used in heavily used LINQ API.
So, I guess giving a understanding of that is kinda waste of space. Have a look at C# code.
 People familiar with LINQ and lovers of Lambda will definitely argue that this is can be replaced by delegates.</div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         63 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('http://kunjan.in/images/cover.jpg');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>


<script src="http://kunjan.in/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>


  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/fsharp.min.js"></script>
  


<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>


  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'http:\/\/kunjan.in\/2016\/12\/epic-adventure-using-fsharp\/';
          
            this.page.identifier = '\/2016\/12\/epic-adventure-using-fsharp\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'kunjan';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  



    
  </body>
</html>

