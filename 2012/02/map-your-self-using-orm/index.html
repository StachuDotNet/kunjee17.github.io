<!DOCTYPE html>
<html dir="ltr" lang="en-US">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="last-modified" content="2015-12-19T22:13:47.7602898+05:30" />
    <title>Kunjan a.k.a. Kunjee's blog</title>
    <link rel="stylesheet" type="text/css" href="/stylesheets/style.css" />
    <link rel="shortcut icon" href="/images/favicon.ico" type="image/ico">
    <link rel="shortcut icon" href="/images/favicon.gif" type="image/gif">
    <link rel="canonical" href="http://kunjan.in/2012/02/map-your-self-using-orm/" />
</head>
<body class="home blog">
    <div id="page" class="hfeed site">
        <header id="masthead" class="site-header fancy-container lightgreen" role="banner">
            <hgroup>
                <h1 class="site-title"><a href="/" title="Kunjee's Blog" rel="home">Kunjan's Blog</a></h1>
                <h2><small>Why Did the Chicken Cross the Möbius Strip?</small></h2>
                <p class="site-description"> All idea, opinion are my own and don't reflect opinion of my current or any former employer. </p>
                
        </hgroup>
        <nav role="navigation" class="site-navigation main-navigation">
            <h1 class="assistive-text">Menu</h1>
            <div class="assistive-text skip-link"><a href="#content" title="Skip to content">Skip to content</a></div>
            <div class="menu">
                <ul>

                    <li><a href="/category">Categories</a></li>
                    <li><a href="/archive">Archive</a></li>
                    <li><a href="/resume">Resume</a></li>
                    <li><a href="/about">About</a></li>
                    <li><a href="/search">Search</a></li>
                    <li><a href="/rss.xml">RSS</a> / <a href="/feed.xml">Atom</a></li>
                </ul>
            </div>
        </nav>
    </header>
    <div id="main">
        <div id="primary" class="site-content">
            <div id="content" role="main">

                
<meta name="description" content="A quick introduction of wonderful ORM provided by Microsoft named Entity Framework." />
<meta name="author" content="Kunjan Dalal" />
<div id="post">
  <h1>Map your self using ORM</h1>
  <div class="post-note">
    posted on 14 Feb 2012
    | <a href="/category/technical">Technical</a>
    | <a href="/category/dotnet">DotNet</a>

<!--       <div class="addthis_toolbox addthis_default_style" style="float:right;">
        <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
        <a class="addthis_button_tweet"></a>
        <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
        <a class="addthis_button_linkedin_counter"></a>
        <a class="addthis_counter addthis_pill_style"></a>
      </div>
    -->

    <!-- AddThis Button BEGIN -->
    <div class="hidden-phone">
      <div class="addthis_toolbox addthis_default_style addthis_32x32_style" addthis:title="Map your self using ORM">
        <a class="addthis_button_preferred_1"></a>
        <a class="addthis_button_preferred_2"></a>
        <a class="addthis_button_preferred_3"></a>
        <a class="addthis_button_preferred_4"></a>
        <a class="addthis_button_compact"></a>
        <a class="addthis_counter addthis_bubble_style"></a>
      </div>
    </div>
    <!-- AddThis Button END -->




  </div>

  

  <p>Many of you must know this word, “ORM”. Then why this post. But trust, even after we have a lots and lots of ORMs in market and some company still using age old technology. Just few days back in one company again I had to face same old question about connection class and command class. Why?????????? It is so true that one must know that things, but this question is always be a nightmare to me.</p>

<p>When I have a java advanced as a subject, I use to do all things other than JDBC connection. I had never completed a single database connection using JDBC. And may be that is the reason why I haven’t choose career with Java. I am not Ninja anymore. It is my unfulfilled dream!!!</p>

<p>Let’s come back to .net. We used to have connection and command class rule the arena in .net. Every interview starts with that and blast because of that. Question starts with</p>

<blockquote>
  <p>What is connection class? And what are the uses of it?</p>
  
  <p>What is command class?</p>
  
  <p>Difference between data set and data reader?
  <!--excerpt-->
  Some, time I do wonder I was going to be selected for making application or “<strong>connection to</strong>” database class. And then we had few more option to connect to database. Few other question which are still unanswered, like</p>
  
  <p>Where I should put connection string? In web config or in single class?</p>
  
  <p>How much time I should allow to connection be open?</p>
  
  <p>How can I use connection pulling?</p>
</blockquote>

<p>I still don’t know answer of last question. And problem not ends there. We need to implement <a href="http://en.wikipedia.org/wiki/Software_design_pattern">design pattern</a> , had to implement interface to follow <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself">DRY</a> . And what actually happened that we became DRY to do all this stuff. At least I do become DRY, pushing my self more for technical stuff rather then concentrating on giving output. Microsoft try to help us by pushing library like <a href="http://msdn.microsoft.com/en-us/library/ff649538.aspx">DAAB</a> . But still open source community is far ahead of this. Java had <a href="http://en.wikipedia.org/wiki/Hibernate_%28Java%29">Hibernate</a> And also then comes hibernate port of .net <a href="http://en.wikipedia.org/wiki/NHibernate">nHibernate</a> . And then Microsoft comes with <a href="http://en.wikipedia.org/wiki/LINQ_to_SQL#LINQ_to_SQL_.28formerly_called_DLINQ.29">Linq to SQL</a> .</p>

<p>All these are <a href="http://en.wikipedia.org/wiki/Object-Relational_Mapping">ORM</a> s. Full form of ORM is object relational mapping. What it does that it mapped the database table with equivalent object. This make CRUD operation easy like anything. And internally it takes care of every thing starting from connection life cycle to generating equivalent query for that.</p>

<p>So, now I don’t worry about connection and commands but work more on business logic. Yes, of course I am saving name <a href="http://en.wikipedia.org/wiki/Entity_Framework">Entity Framework</a> for my example of ORM. It is final blow from Microsoft. And to do <a href="http://en.wikipedia.org/wiki/Rapid_application_development">RAD</a> type development it is best product till now from Microsoft, even better than <a href="http://www.asp.net/web-forms">web forms</a> .</p>

<p>Now, the example. I am using age old North-wind database. Also using <a href="http://en.wikipedia.org/wiki/SQL_CE">SQL CE</a> . Now, what you need to do is add new file and chose data option, find Entity file and add it. Choose northwind file and “next next next”. Just don’t forget to choose all database. That’s it its done.</p>

<p>I am so lazy person by default. So, I am using <a href="http://nuget.org/packages/MvcScaffolding">MVCScaffolding</a> to generate classes. You can do as your wish.</p>

<p>So, what I have done here is add Entity Framework file (dbml) file. Which is xml file which shows mapping between database and object. Than fired a scaffold command. That it. After this I got the error.</p>

<p>Basically Scaffold command is designed for EF Code First by default and I haven’t customized for simple Entity Framework. So, I do have to modified some of the code and that is it. It is done and working perfectly. Here is the code snippet with details.</p>

<p>I have taken customer table for example.</p>

<p>Created <a href="http://en.wikipedia.org/wiki/Interface">interface</a> for basic <a href="http://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> operations.</p>

<pre><code>public interface ICustomerRepository { 
IQueryableCustomer All { get ; } 
IQueryableCustomer AllIncluding( params ExpressionFuncCustomer , object[] includeProperties); 
Customer Find( string id); 
void InsertOrUpdate( Customer customer); 
void Delete( string id); 
void Save(); 
</code></pre>

<p>} </p>

<p>and then create the repository class to do the task.</p>

<pre><code>public class CustomerRepository : ICustomerRepository { 
NorthwindEntities context = new NorthwindEntities (); 
public IQueryableCustomer All { get { return context.Customers; } } 
public IQueryableCustomer AllIncluding( params ExpressionFuncCustomer , object [] includeProperties) 
  { 
    IQueryableCustomer query = context.Customers; 
    foreach ( var includeProperty in includeProperties) 
      { query = query.Include(includeProperty); } 
    return query; 
  } 
public Customer Find( string id) { 
  return context.Customers.Where(c =&gt; c.Customer_ID == id).FirstOrDefault(); 
} 
public void InsertOrUpdate( Customer customer) { 
  var _customer = Find(customer.Customer_ID); 
  if (_customer != null ) { 
    _customer.Address = customer.Address; 
    _customer.City = customer.City;   
    _customer.Company_Name = customer.Company_Name; 
    _customer.Contact_Name = customer.Contact_Name; 
    _customer.Contact_Title = customer.Contact_Title; 
    _customer.Country = customer.Contact_Title; 
    _customer.Fax = customer.Fax; 
    _customer.Phone = customer.Phone; 
    _customer.Postal_Code = customer.Postal_Code; 
    _customer.Region = customer.Region; 
    // Haven't taken orders in update just for demo purpose only 
  } else { 
    context.Customers.AddObject(customer); 
  } 
} 
public void Delete( string id) { 
  var customer = Find(id); 
  context.Customers.DeleteObject(customer); 
} 
public void Save() { 
  context.SaveChanges(); 
} 
</code></pre>

<p>} 
we add one line to application start to solve dependency. kernel.Bind</p>

<pre><code>ICustomerRepository().ToCustomerRepository(); 
</code></pre>

<p>Now, we have basic methods in our customer’s controller to do all the basic operations.</p>

<pre><code>public class CustomersController : Controller { 
private readonly ICustomerRepository customerRepository; 
public CustomersController( ICustomerRepository customerRepository) { 
  this .customerRepository = customerRepository; 
} 

// GET: Customers 
public ViewResult Index() { 
  return View(customerRepository.AllIncluding(customer.Orders)); 
} 

// GET: /Customers/Details/5 
public ViewResult Details( string id) { 
  return View(customerRepository.Find(id)); } 

// GET: /Customers/Create 
public ActionResult Create() { 
  return View(); 
} 

// POST: /Customers/Create 
[ HttpPost ] 
public ActionResult Create( Customer customer) { 
  if (ModelState.IsValid) { 
    customerRepository.InsertOrUpdate(customer); customerRepository.Save(); 
    return RedirectToAction( "Index" ); 
    } else { 
      return View(); 
    } 
  } 

  // GET: /Customers/Edit/5 
public ActionResult Edit( string id) { 
  return View(customerRepository.Find(id)); 
} 

// POST: /Customers/Edit/5 
[ HttpPost ] 
public ActionResult Edit( Customer customer) { 
  if (ModelState.IsValid) { 
    customerRepository.InsertOrUpdate(customer); customerRepository.Save(); 
    return RedirectToAction( "Index" ); 
  } else { 
    return View(); 
  } 
} 

// GET: /Customers/Delete/5 
public ActionResult Delete( string id) { 
  return View(customerRepository.Find(id)); } 

// POST: /Customers/Delete/5  
[HttpPost ActionName ( "Delete" )] 
public ActionResult DeleteConfirmed( string id){ 
  customerRepository.Delete(id); 
  customerRepository.Save(); 
  return RedirectToAction( "Index" ); 
} 
</code></pre>

<p>} </p>

<p>now, just you need views according to Action Results.</p>

<p>I have shared project on <a href="https://github.com/">Github</a> at <a href="https://github.com/kunjee17/kunjan-web-space">my repository</a> . So, do check out for any missing code. You can check out for Demo Application there.</p>

<p>See, no connection, no command just a clean beautiful code and work is done. Entity Framework will take care about every thing else.</p>

<p>We can use any other <a href="http://en.wikipedia.org/wiki/Object-Relational_Mapping">ORM</a> s too. One of my favorite <a href="http://orchardproject.net/">Orchard</a> is using <a href="http://nhforge.org/Default.aspx">NHibernate</a> . It is far mature than any other ORM in .Net. And lots and lots of features to work on. I will work on it in my next articles.</p>

<p>One more thing to add. It takes more time to copy paste the code than creating it. So, you can imagine how fast it is!!!</p>


  <div id="disqus_thread"></div>
<script>
    var reset_disqus = function(){
        DISQUS.reset({
            reload: true,
            config: function () {
                //this.page.identifier = '';
                this.page.url = 'http://kunjan.in/2012/02/map-your-self-using-orm/';
                //this.page.title = '';
            }
        });
    };

    var disqus_shortname = 'kunjan';
    var disqus_url = 'http://kunjan.in/2012/02/map-your-self-using-orm/';

    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    window.addEventListener('orientationchange', reset_disqus);
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f054dec05e2662c"></script>

</div>
            </div>
            <!-- #content -->
        </div>
        <!-- #primary .site-content -->

        <div id="secondary" class="widget-area fancy-container lightred" role="complementary">
            <aside id="text-5" class="widget widget_text">
                <h1 class="widget-title">Follow</h1>
                <div class="textwidget logos">
                    <a href="https://twitter.com/kunjee" target="_blank" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://twitter.com']);"><img src="/stylesheets/images/twitter.png"></a>
                    <a href="http://stackoverflow.com/users/859490/kunjee" target="_blank" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://stackoverflow.com']);"><img src="/stylesheets/images/stackoverflow.png"></a>
                    <a href="http://www.linkedin.com/in/kunjee17" target="_blank" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://www.linkedin.com']);"><img src="/stylesheets/images/linkedin.png"></a>
                    <a href="https://github.com/kunjee17" target="_blank" onclick="javascript:_gaq.push(['_trackEvent','outbound-widget','http://github.com']);"><img src="/stylesheets/images/github.png"></a>

                </div>
                <a href="http://stackoverflow.com/users/859490/kunjee" target="_blank">
                  <img src="http://stackoverflow.com/users/flair/859490.png" width="208" height="58" alt="profile for Kunjan at Stack Overflow, Q&amp;A for professional and enthusiast programmers" title="profile for Kunjan at Stack Overflow, Q&amp;A for professional and enthusiast programmers">
              </a>

          </aside>

          <aside id="linkcat-6" class="widget widget_links">
            <h1 class="widget-title">Other Blogs</h1>
            <ul class='xoxo blogroll'>
                <li><a href="http://www.hanselman.com/blog/" target="_blank" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://www.hanselman.com/blog/']);">Scott Hanselman</a></li>
                <li><a href="http://www.wekeroad.com/" target="_blank" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://www.wekeroad.com/']);">Rob Conery</a></li>
                <li><a href="http://haacked.com/" target="_blank" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://haacked.com/']);">Phil Haack</a></li>
                <li><a href="http://hanselminutes.com/" target="_blank" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://hanselminutes.com/']);">Hanselminutes</a></li>
                <li><a href="https://sergeytihon.wordpress.com/category/f-weekly/" target="_blank" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','https://sergeytihon.wordpress.com/category/f-weekly/']);">F# Weekly</a></li>
                <li><a href="http://fsharpforfunandprofit.com/" target="_blank" onclick="javascript:_gaq.push(['_trackEvent','outbound-blogroll','http://fsharpforfunandprofit.com/']);">F# for Fun and Profit</a></li>
            </ul>

        </aside>
        <aside id="archives-4" class="widget widget_archive">
            <h1 class="widget-title">Archive</h1>
            <ul class="posts">
                <li><a href="/archive#201512">December, 2015</a></li>
                <li><a href="/archive#201511">November, 2015</a></li>
                <li><a href="/archive#20154">April, 2015</a></li>
                <li><a href="/archive#20153">March, 2015</a></li>
                <li><a href="/archive#201411">November, 2014</a></li>
                <li><a href="/archive#201410">October, 2014</a></li>
                <li><a href="/archive#20146">June, 2014</a></li>
                <li><a href="/archive#20144">April, 2014</a></li>
                <li><a href="/archive#20143">March, 2014</a></li>
                <li><a href="/archive#20142">February, 2014</a></li>
                <li><a href="/archive#201312">December, 2013</a></li>
                <li><a href="/archive#201311">November, 2013</a></li>
                <li><a href="/archive#201310">October, 2013</a></li>
                <li><a href="/archive#20138">August, 2013</a></li>
                <li><a href="/archive#20131">January, 2013</a></li>
                <li><a href="/archive#201212">December, 2012</a></li>
                <li><a href="/archive#201211">November, 2012</a></li>
                <li><a href="/archive#201210">October, 2012</a></li>
                <li><a href="/archive#20129">September, 2012</a></li>
                <li><a href="/archive#20124">April, 2012</a></li>
                <li><a href="/archive#20123">March, 2012</a></li>
                <li><a href="/archive#20122">February, 2012</a></li>
                <li><a href="/archive#20121">January, 2012</a></li>
                <li><a href="/archive#201112">December, 2011</a></li>
                <li><a href="/archive#201111">November, 2011</a></li>
                <li><a href="/archive#201110">October, 2011</a></li>
        </ul>
    </aside>
</div>
<!-- #secondary .widget-area -->


</div>
<!-- #main -->

<footer id="colophon" class="site-footer" role="contentinfo">
    <div class="site-info">
        Powered by <a href="https://github.com/Sandra/Sandra.Snow" rel="generator">Sandra.Snow</a>.	
    </div>
    <!-- .site-info -->
</footer>
<!-- #colophon .site-footer -->
</div>
<!-- #page .hfeed .site -->
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src='/javascripts/prettify.js' type='text/javascript'></script>

<script type="text/javascript">
var _gaq = _gaq || [];

_gaq.push(['_setAccount', 'UA-37975068-1']);
_gaq.push(['_trackPageview']);
        
(function () {
    var ga = document.createElement('script');
    ga.type = 'text/javascript';
    ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(ga, s);
})();
</script>

<script type='text/javascript'>
  $(function () {
    $("pre code").parent().each(function () {
      if (!$(this).hasClass("prettyprint")) {
        $(this).addClass("prettyprint");
        a = true
    }
});

    prettyPrint();
});


  $(function(){
    $.ajax({
        url: "http://dynamic.xkcd.com/api-0/jsonp/comic?callback=?",
        dataType: "json",
        jsonpCallback: "xkcddata",
        success: function(data) {
            $("#xkcdcontent").append(
                $("<h1/>").text(data.title),
                $("<img/>").attr({
                    src: data.img,
                    title: data.alt,
                    alt: data.title
                })
                );
        }
    });
});
</script>
</body>
</html>
